<app-list-header
  title="Company Wizard"
  description="Edit company with all details."
>
  <button
    mat-raised-button
    class="header-button"
    color="warn"
    (click)="cancelCompanyWizardForm()"
  >
    cancel
  </button>
</app-list-header>

<mat-horizontal-stepper class="company-wizard-stepper" linear>
  <mat-step
    [formGroup]="companyWizardForm"
    [stepControl]="generalInfoFormGroup"
    optional="false"
  >
    <ng-template matStepLabel> Company Details</ng-template>
    <div class="form-group-container" formGroupName="generalInfo">
      <div>
        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>business name</mat-label>
            <input matInput formControlName="businessName" required />
            <mat-error> Business name is <strong>required</strong> </mat-error>
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>address line 1</mat-label>
            <input matInput formControlName="address1" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>address line 2</mat-label>
            <input matInput formControlName="address2" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>town</mat-label>
            <input matInput formControlName="town" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>country</mat-label>
            <input matInput formControlName="country" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>postcode</mat-label>
            <input matInput formControlName="postcode" required />
            <mat-error> Postcode is <strong>required</strong></mat-error>
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>Phone number</mat-label>
            <input matInput formControlName="phoneNumber" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>private address</mat-label>
            <input matInput formControlName="privateAddress" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>email</mat-label>
            <input matInput formControlName="email" />
          </mat-form-field>
        </div>

        <div class="form-control-container">
          <mat-form-field class="mat-input">
            <mat-label>CRM Order Number</mat-label>
            <input
              matInput
              formControlName="CRMOrderNumber"
              [disabled]="true"
            />
          </mat-form-field>
        </div>
        <div class="form-control-container">
          <mat-card-title>Company Location</mat-card-title>
          <p>Drag and drop the pin to locate your position</p>
          <agm-map [latitude]="latitude" [longitude]="longitude">
            <agm-marker
              [latitude]="generalInfoFormGroup.get('companyLat').value"
              [longitude]="generalInfoFormGroup.get('companyLng').value"
              [markerDraggable]="true"
              (dragEnd)="markerDragEnd($event)"
            >
            </agm-marker>
          </agm-map>
        </div>
        <button mat-button mat-raised-button matStepperNext color="accent">
          Next
        </button>
      </div>
    </div>
  </mat-step>
  <mat-step
    [formGroup]="companyWizardForm"
    [stepControl]="locationsFormArray"
    optional="false"
  >
    <ng-template matStepLabel> Locations </ng-template>
    <div formArrayName="locations" class="form-group-container">
      <mat-accordion>
        <mat-expansion-panel
          *ngFor="let location of locationsFormArray.controls; let i = index"
          [formGroupName]="i"
        >
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ location.get("name").value || "New Location" }}
            </mat-panel-title>
            <mat-panel-description>
              <mat-icon
                *ngIf="i !== 0"
                (click)="removeLocationFromLocationsFormArray(i)"
                >delete</mat-icon
              >
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div>
            <div class="form-control-container">
              <mat-form-field class="mat-input">
                <mat-label>name</mat-label>
                <input
                  matInput
                  placeholder="Name"
                  formControlName="name"
                  required
                />
                <mat-error> Name is <strong>required</strong> </mat-error>
              </mat-form-field>
            </div>
            <div class="form-control-container">
              <mat-form-field class="mat-input">
                <mat-label>address 1</mat-label>
                <input
                  matInput
                  placeholder="Address 1"
                  formControlName="address1"
                />
                <mat-error> Address 1 is <strong>required</strong> </mat-error>
              </mat-form-field>
            </div>

            <div class="form-control-container">
              <mat-form-field class="mat-input">
                <mat-label>Address 2</mat-label>
                <input
                  matInput
                  placeholder="Address 1"
                  formControlName="address2"
                />
                <mat-error> Address 2 is <strong>required</strong> </mat-error>
              </mat-form-field>
            </div>

            <div class="form-control-container">
              <mat-form-field class="mat-input">
                <mat-label>town</mat-label>
                <input matInput placeholder="Town" formControlName="town" />
                <mat-error> Town is <strong>required</strong> </mat-error>
              </mat-form-field>
            </div>

            <div class="form-control-container">
              <mat-form-field class="mat-input">
                <mat-label>country</mat-label>
                <input
                  matInput
                  placeholder="Country"
                  formControlName="country"
                />
                <mat-error> Country is <strong>required</strong> </mat-error>
              </mat-form-field>
            </div>

            <div class="form-control-container">
              <app-multi-select-chips
                [optionsArray]="currencyList"
                [control]="location.get('currency')"
                inputLabel="currency"
                isRequired="true"
              ></app-multi-select-chips>
            </div>

            <div class="form-control-container">
              <mat-form-field class="mat-input">
                <mat-label>postcode</mat-label>
                <input
                  matInput
                  placeholder="Postcode"
                  formControlName="postcode"
                  required
                />
                <mat-error> Postcode is <strong>required</strong> </mat-error>
              </mat-form-field>
            </div>
            <div class="form-control-container">
              <mat-card-title>Company Location</mat-card-title>
              <p>Drag and drop the pin to locate your position</p>
              <agm-map [latitude]="latitude" [longitude]="longitude">
                <agm-marker
                  [latitude]="location.get('companyLat').value"
                  [longitude]="location.get('companyLng').value"
                  [markerDraggable]="true"
                  (dragEnd)="LocationArrayMarkerDragEnd($event, i)"
                >
                </agm-marker>
              </agm-map>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
      <div class="row button-container">
        <div class="col-6">
          <button mat-raised-button color="accent" matStepperNext>
            next
          </button>
        </div>
        <div class="col-6">
          <button mat-mini-fab (click)="addLocationToLocationsFormArray()">
            <mat-icon aria-label="Example icon-button with a heart icon"
              >add</mat-icon
            >
          </button>
        </div>
      </div>
    </div>
  </mat-step>
  <mat-step optional="false">
    <ng-template matStepLabel> Summary </ng-template>
    <mat-card class="company-result-card">
      <mat-card-title>
        Form Information Successfully applied
      </mat-card-title>

      <mat-card-content>
        <mat-card-subtitle>
          your form is completed if you are sure about your company details
          press save
        </mat-card-subtitle>

        <mat-card-actions>
          <button
            mat-raised-button
            class="header-button"
            color="accent"
            [disabled]="!companyWizardForm.valid"
            (click)="saveCompanyWizardForm()"
          >
            save
          </button>
        </mat-card-actions>
      </mat-card-content>
    </mat-card>
  </mat-step>
</mat-horizontal-stepper>
